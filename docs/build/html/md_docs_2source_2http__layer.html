<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>COAR Notify: Creating Your Own HTTP Layer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">COAR Notify
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_docs_2source_2http__layer.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Creating Your Own HTTP Layer</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md7"></a></p>
<p>The HTTP layer is the mechanism by which notifications are sent to the target inbox. The HTTP layer is designed to be customizable, so that you can use your own HTTP library or build in custom authentication routines.</p>
<p>The HTTP layer interface and default implementation can be found in <code>src/http</code>.</p>
<p>To use a custom HTTP layer, you provide this at the time of creating the client:</p>
<div class="fragment"><div class="line">use <a class="code hl_class" href="classcoarnotify_1_1client_1_1COARNotifyClient.html">coarnotify\client\COARNotifyClient</a>;</div>
<div class="line">use my_custom_http_layer\MyCustomHTTPLayer;</div>
<div class="line"> </div>
<div class="line">$client = <span class="keyword">new</span> COARNotifyClient(http_layer: <span class="keyword">new</span> MyCustomHTTPLayer());</div>
<div class="ttc" id="aclasscoarnotify_1_1client_1_1COARNotifyClient_html"><div class="ttname"><a href="classcoarnotify_1_1client_1_1COARNotifyClient.html">coarnotify\client\COARNotifyClient</a></div><div class="ttdef"><b>Definition</b> COARNotifyClient.php:12</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md8"></a>
Implementing HTTP Layer with Authentication</h1>
<p>To add authentication to your HTTP layer, one way of doing this would be to extend the existing CURL-based implementation to layer the authentication on top.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>AuthCurlHttpLayer <span class="keyword">extends</span> CurlHttpLayer</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">string</span> $username;</div>
<div class="line">    <span class="keyword">private</span> <span class="keywordtype">string</span> $password;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> __construct(<span class="keywordtype">string</span> $username, <span class="keywordtype">string</span> $password)</div>
<div class="line">    {</div>
<div class="line">        $this-&gt;username = $username;</div>
<div class="line">        $this-&gt;password = $password;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> post(<span class="keywordtype">string</span> $url, <span class="keywordtype">string</span> $data, ?array $headers = [], ...$args): CurlHttpResponse</div>
<div class="line">    {</div>
<div class="line">        $authHeader = $this-&gt;getAuthHeader();</div>
<div class="line">        $headers = array_merge($headers, $authHeader);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> parent::post($url, $data, $headers, ...$args);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <span class="keyword">get</span>(<span class="keywordtype">string</span> $url, ?array $headers = [], ...$args): CurlHttpResponse</div>
<div class="line">    {</div>
<div class="line">        $authHeader = $this-&gt;getAuthHeader();</div>
<div class="line">        $headers = array_merge($headers, $authHeader);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> parent::get($url, $headers, ...$args);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">function</span> getAuthHeader(): array</div>
<div class="line">    {</div>
<div class="line">        $authToken = base64_encode(<span class="stringliteral">&quot;{$this-&gt;username}:{$this-&gt;password}&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> [<span class="stringliteral">&#39;Authorization: Basic &#39;</span> . $authToken];</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
Implementing HTTP Layer with Alternative Library</h1>
<p>If your application already relies on another HTTP library, you can implement the HTTP layer using that library instead.</p>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>my_custom_http_layer;</div>
<div class="line"> </div>
<div class="line">use <a class="code hl_interface" href="interfacecoarnotify_1_1http_1_1HttpLayer.html">coarnotify\http\HttpLayer</a>;</div>
<div class="line">use <a class="code hl_interface" href="interfacecoarnotify_1_1http_1_1HttpResponse.html">coarnotify\http\HttpResponse</a>;</div>
<div class="line">use my_http_library\MyHttpLibrary;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MyCustomHTTPLayer <span class="keyword">implements</span> HttpLayer</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> post(<span class="keywordtype">string</span> $url, <span class="keywordtype">string</span> $data, array $headers = [], ...$args): CustomHttpResponse</div>
<div class="line">    {</div>
<div class="line">        $resp = MyHttpLibrary::makeRequest(<span class="stringliteral">&quot;POST&quot;</span>, $url, $data, $headers, ...$args);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> CustomHttpResponse($resp);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <span class="keyword">get</span>(<span class="keywordtype">string</span> $url, array $headers = [], ...$args): CustomHttpResponse</div>
<div class="line">    {</div>
<div class="line">        $resp = MyHttpLibrary::makeRequest(<span class="stringliteral">&quot;GET&quot;</span>, $url, <span class="keyword">null</span>, $headers, ...$args);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> CustomHttpResponse($resp);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>CustomHttpResponse <span class="keyword">implements</span> HttpResponse</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">private</span> $resp;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> __construct($resp)</div>
<div class="line">    {</div>
<div class="line">        $this-&gt;resp = $resp;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> header(<span class="keywordtype">string</span> $headerName): string</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;resp-&gt;getResponseHeader($headerName);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> getStatusCode(): int</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;resp-&gt;getStatusCode();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="ainterfacecoarnotify_1_1http_1_1HttpLayer_html"><div class="ttname"><a href="interfacecoarnotify_1_1http_1_1HttpLayer.html">coarnotify\http\HttpLayer</a></div><div class="ttdef"><b>Definition</b> HttpLayer.php:6</div></div>
<div class="ttc" id="ainterfacecoarnotify_1_1http_1_1HttpResponse_html"><div class="ttname"><a href="interfacecoarnotify_1_1http_1_1HttpResponse.html">coarnotify\http\HttpResponse</a></div><div class="ttdef"><b>Definition</b> HttpResponse.php:6</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
